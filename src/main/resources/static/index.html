<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionCar - Gest√£o de Ve√≠culos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            font-weight: bold;
            color: #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .filters {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .cars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .car-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .car-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .car-model {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .car-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-available {
            background: #d4edda;
            color: #155724;
        }

        .status-sold {
            background: #f8d7da;
            color: #721c24;
        }

        .car-info {
            margin: 10px 0;
        }

        .car-info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .car-info-label {
            color: #666;
            font-weight: 500;
        }

        .car-info-value {
            color: #333;
            font-weight: 600;
        }

        .car-price {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin: 15px 0;
        }

        .car-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-edit {
            flex: 1;
            background: #ffc107;
            padding: 10px;
        }

        .btn-delete {
            flex: 1;
            background: #dc3545;
            padding: 10px;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>üöó VisionCar</h1>
        <p>Sistema de Gest√£o de Ve√≠culos</p>
    </header>

    <div class="tabs">
        <button class="tab active" onclick="showTab('list')">Listar Ve√≠culos</button>
        <button class="tab" onclick="showTab('add')">Cadastrar Ve√≠culo</button>
        <button class="tab" onclick="showTab('brands')">Gerenciar Marcas</button>
    </div>

    <div class="content">
        <div id="list-tab" class="tab-content active">
            <div class="filters">
                <h2 style="margin-bottom: 20px;">Filtros de Busca</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Marca</label>
                        <select id="filterBrand" onchange="filterCars()">
                            <option value="">Todas as marcas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Modelo</label>
                        <input type="text" id="filterModel" placeholder="Digite o modelo" onkeyup="filterCars()">
                    </div>
                    <div class="form-group">
                        <label>Pre√ßo M√≠nimo</label>
                        <input type="number" id="filterMinPrice" placeholder="R$ 0" onchange="filterCars()">
                    </div>
                    <div class="form-group">
                        <label>Pre√ßo M√°ximo</label>
                        <input type="number" id="filterMaxPrice" placeholder="R$ 999999" onchange="filterCars()">
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <label>
                        <input type="checkbox" id="filterAvailable" onchange="filterCars()">
                        Apenas dispon√≠veis
                    </label>
                </div>
            </div>
            <div id="carsList" class="cars-grid"></div>
        </div>

        <div id="add-tab" class="tab-content">
            <h2 style="margin-bottom: 20px;">Cadastrar Novo Ve√≠culo</h2>
            <div id="addMessage" class="message"></div>
            <form id="carForm" onsubmit="saveCar(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Modelo *</label>
                        <input type="text" id="model" required>
                    </div>
                    <div class="form-group">
                        <label>Marca *</label>
                        <select id="brandId" required></select>
                    </div>
                    <div class="form-group">
                        <label>Cor *</label>
                        <select id="color" required>
                            <option value="PRETO">Preto</option>
                            <option value="BRANCO">Branco</option>
                            <option value="PRATA">Prata</option>
                            <option value="CINZA">Cinza</option>
                            <option value="VERMELHO">Vermelho</option>
                            <option value="AZUL">Azul</option>
                            <option value="VERDE">Verde</option>
                            <option value="AMARELO">Amarelo</option>
                            <option value="LARANJA">Laranja</option>
                            <option value="MARROM">Marrom</option>
                            <option value="ROXO">Roxo</option>
                            <option value="BEGE">Bege</option>
                            <option value="DOURADO">Dourado</option>
                            <option value="OUTROS">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pre√ßo (R$) *</label>
                        <input type="number" id="price" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Ano de Fabrica√ß√£o *</label>
                        <input type="number" id="manufacturingYear" min="1900" max="2025" required>
                    </div>
                    <div class="form-group">
                        <label>Quilometragem</label>
                        <input type="number" id="kilometersDriven" step="0.1" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="isNew"> Ve√≠culo novo (0 km)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="isAvaliable" checked> Dispon√≠vel para venda
                        </label>
                    </div>
                </div>
                <input type="hidden" id="carId">
                <button type="submit">Salvar Ve√≠culo</button>
                <button type="button" onclick="resetForm()" style="background: #6c757d; margin-left: 10px;">Limpar</button>
            </form>
        </div>

        <div id="brands-tab" class="tab-content">
            <h2 style="margin-bottom: 20px;">Gerenciar Marcas</h2>
            <div id="brandMessage" class="message"></div>
            <form onsubmit="addBrand(event)" style="margin-bottom: 30px;">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome da Marca</label>
                        <input type="text" id="brandName" placeholder="Ex: Toyota" required>
                    </div>
                </div>
                <button type="submit">Adicionar Marca</button>
            </form>
            <div id="brandsList"></div>
        </div>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:8080/visionCar';
    let allCars = [];
    let allBrands = [];

    function showTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        event.target.classList.add('active');
        document.getElementById(tab + '-tab').classList.add('active');

        if (tab === 'list') loadCars();
        if (tab === 'add' || tab === 'list') loadBrands();
        if (tab === 'brands') loadBrandsForManagement();
    }

    async function loadBrands() {
        try {
            const response = await fetch(API_URL + '/brand');
            allBrands = await response.json();

            const brandSelect = document.getElementById('brandId');
            const filterBrandSelect = document.getElementById('filterBrand');

            brandSelect.innerHTML = '<option value="">Selecione uma marca</option>';
            filterBrandSelect.innerHTML = '<option value="">Todas as marcas</option>';

            allBrands.forEach(brand => {
                brandSelect.innerHTML += `<option value="${brand.id}">${brand.name}</option>`;
                filterBrandSelect.innerHTML += `<option value="${brand.name}">${brand.name}</option>`;
            });
        } catch (error) {
            console.error('Erro ao carregar marcas:', error);
        }
    }

    async function loadCars() {
        document.getElementById('carsList').innerHTML = '<div class="loading">Carregando ve√≠culos...</div>';
        try {
            const response = await fetch(API_URL);
            allCars = await response.json();
            displayCars(allCars);
        } catch (error) {
            document.getElementById('carsList').innerHTML = '<p>Erro ao carregar ve√≠culos.</p>';
        }
    }

    function displayCars(cars) {
        const carsList = document.getElementById('carsList');
        if (cars.length === 0) {
            carsList.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">Nenhum ve√≠culo encontrado.</p>';
            return;
        }

        carsList.innerHTML = cars.map(car => `
            <div class="car-card">
                <div class="car-header">
                    <div class="car-model">${car.model}</div>
                    <span class="car-status ${car.isAvaliable ? 'status-available' : 'status-sold'}">
                        ${car.isAvaliable ? 'Dispon√≠vel' : 'Vendido'}
                    </span>
                </div>
                <div class="car-info">
                    <div class="car-info-item">
                        <span class="car-info-label">Marca:</span>
                        <span class="car-info-value">${car.brand.name}</span>
                    </div>
                    <div class="car-info-item">
                        <span class="car-info-label">Ano:</span>
                        <span class="car-info-value">${car.manufacturingYear}</span>
                    </div>
                    <div class="car-info-item">
                        <span class="car-info-label">Cor:</span>
                        <span class="car-info-value">${car.color}</span>
                    </div>
                    <div class="car-info-item">
                        <span class="car-info-label">KM:</span>
                        <span class="car-info-value">${car.kilometersDriven.toLocaleString('pt-BR')} km</span>
                    </div>
                    <div class="car-info-item">
                        <span class="car-info-label">Condi√ß√£o:</span>
                        <span class="car-info-value">${car.isNew ? 'Novo (0 km)' : 'Usado'}</span>
                    </div>
                </div>
                <div class="car-price">R$ ${car.price.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                <div class="car-actions">
                    <button class="btn-edit" onclick="editCar(${car.id})">Editar</button>
                    <button class="btn-delete" onclick="deleteCar(${car.id})">Excluir</button>
                </div>
            </div>
        `).join('');
    }

    function filterCars() {
        const brand = document.getElementById('filterBrand').value.toLowerCase();
        const model = document.getElementById('filterModel').value.toLowerCase();
        const minPrice = parseFloat(document.getElementById('filterMinPrice').value) || 0;
        const maxPrice = parseFloat(document.getElementById('filterMaxPrice').value) || Infinity;
        const availableOnly = document.getElementById('filterAvailable').checked;

        const filtered = allCars.filter(car => {
            const matchBrand = !brand || car.brand.name.toLowerCase().includes(brand);
            const matchModel = !model || car.model.toLowerCase().includes(model);
            const matchPrice = car.price >= minPrice && car.price <= maxPrice;
            const matchAvailable = !availableOnly || car.isAvaliable;

            return matchBrand && matchModel && matchPrice && matchAvailable;
        });

        displayCars(filtered);
    }

    async function saveCar(event) {
        event.preventDefault();

        const carId = document.getElementById('carId').value;
        const car = {
            model: document.getElementById('model').value,
            brand: { id: parseInt(document.getElementById('brandId').value) },
            color: document.getElementById('color').value,
            price: parseFloat(document.getElementById('price').value),
            manufacturingYear: parseInt(document.getElementById('manufacturingYear').value),
            isNew: document.getElementById('isNew').checked,
            kilometersDriven: parseFloat(document.getElementById('kilometersDriven').value) || 0,
            isAvaliable: document.getElementById('isAvaliable').checked
        };

        try {
            const url = carId ? `${API_URL}/${carId}` : API_URL;
            const method = carId ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(car)
            });

            if (response.ok) {
                showMessage('addMessage', 'Ve√≠culo salvo com sucesso!', 'success');
                resetForm();
                loadCars();
            } else {
                showMessage('addMessage', 'Erro ao salvar ve√≠culo.', 'error');
            }
        } catch (error) {
            showMessage('addMessage', 'Erro ao salvar ve√≠culo.', 'error');
        }
    }

    async function editCar(id) {
        const car = allCars.find(c => c.id === id);
        if (car) {
            document.getElementById('carId').value = car.id;
            document.getElementById('model').value = car.model;
            document.getElementById('brandId').value = car.brand.id;
            document.getElementById('color').value = car.color;
            document.getElementById('price').value = car.price;
            document.getElementById('manufacturingYear').value = car.manufacturingYear;
            document.getElementById('isNew').checked = car.isNew;
            document.getElementById('kilometersDriven').value = car.kilometersDriven;
            document.getElementById('isAvaliable').checked = car.isAvaliable;

            showTab('add');
            document.querySelector('[onclick="showTab(\'add\')"]').click();
        }
    }

    async function deleteCar(id) {
        if (!confirm('Deseja realmente excluir este ve√≠culo?')) return;

        try {
            const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
            if (response.ok) {
                loadCars();
            }
        } catch (error) {
            alert('Erro ao excluir ve√≠culo.');
        }
    }

    function resetForm() {
        document.getElementById('carForm').reset();
        document.getElementById('carId').value = '';
    }

    async function addBrand(event) {
        event.preventDefault();
        const name = document.getElementById('brandName').value;

        try {
            const response = await fetch(`${API_URL}/brand?name=${encodeURIComponent(name)}`, {
                method: 'POST'
            });

            if (response.ok) {
                showMessage('brandMessage', 'Marca adicionada com sucesso!', 'success');
                document.getElementById('brandName').value = '';
                loadBrandsForManagement();
                loadBrands();
            } else {
                showMessage('brandMessage', 'Erro ao adicionar marca.', 'error');
            }
        } catch (error) {
            showMessage('brandMessage', 'Erro ao adicionar marca.', 'error');
        }
    }

    async function loadBrandsForManagement() {
        try {
            const response = await fetch(API_URL + '/brand');
            const brands = await response.json();

            const brandsList = document.getElementById('brandsList');
            brandsList.innerHTML = '<h3>Marcas Cadastradas</h3>' + brands.map(brand => `
                <div class="car-card" style="margin-top: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>${brand.name}</strong>
                        <span style="color: #666;">ID: ${brand.id}</span>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Erro ao carregar marcas:', error);
        }
    }

    function showMessage(elementId, message, type) {
        const msgElement = document.getElementById(elementId);
        msgElement.textContent = message;
        msgElement.className = `message ${type}`;
        msgElement.style.display = 'block';
        setTimeout(() => msgElement.style.display = 'none', 5000);
    }

    loadCars();
    loadBrands();
</script>
</body>
</html>